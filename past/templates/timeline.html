{% extends "layout.html" %}

{% block content_block %}
<div class="box">
    <div class="cell">
        <span class="bigger">Hi, Welcome to thepast.me</span>
        <div class="sep10"></div>
    </div>

    {% if not status_list and g.start == 0 %}
        <br/>
        <span class="fade">正在努力从第三方网站同步你的timeline，请稍等刷新页面查看...</span>
        <br/> <br/>
    {% endif %}

    {%set sorted_months = status_list.keys()|sort(reverse=True)%}
    {%for m in sorted_months%}
	<!-- 一月循环开始 -->
	<div class="month">
		<!-- 调用时间：XX年XX月 -->
		<h2 class="title">{{m.replace("-","年")}}月</h2>
		
        {%set days_status = status_list[m]%}
        {%set sorted_days = days_status.keys()|sort(reverse=True)%}
        {%for d in sorted_days%}
		<!-- 日循环开始 -->
		<ul class="articles">
			<!-- 调用日期： XX日 -->
			<div class="day"> › {{d}}日</div>
			
            {%for s in days_status[d]%}
            <!-- 每条信息输出楷书 -->
            <li>
                <div class="message">
                    <!-- 调用时间：时分秒 -->
                    <div class="time">{{s.create_time.strftime("%H:%M:%S")}} </div>
                    <!-- 信息内容 + span.from -->
                    {% set images = s.get_data().get_images() or [] %}
                    <div class="text">
                        {{s.text|safe}}

                        {%if s.category == config.CATE_SINA_STATUS%}
                            {% set retweeted = s.get_data().get_retweeted_status() %}
                            {% set re_mid_pic = retweeted and retweeted.get_images() or [] %}
                            {% set images = images + re_mid_pic %}
                            {% if retweeted %}
                                {{ "//@" + retweeted.get_user().get_nickname() + " " + retweeted.get_content() }} 
                            {% endif %}

                        {%endif%}

                        <!-- 来源 -->
                        {%set from_ = s.get_origin_uri()%}
                        {%if from_%}
                            <span class="from {{from_[0]}}"><a href="{{from_[1]}}"></a></span>
                        {%endif%}

                        {% if images %}
                            {%for image in images%}
                                <br />
                                <img src="{{image}}"/>
                            {%endfor%}
                        {% endif %}

                    </div>
                    <!-- 信息内容结束 -->
                </div>
            </li>
            <!-- 每条信息输出结束 -->
            {%endfor%}

		</ul>
		<!-- 日循环结束 -->
        {%endfor%}

	</div>
	<!-- 月循环结束 -->
    {%endfor%}

</div>

<div class="sep10"></div>
<div class="box">
    {% if g.start>0 %}
    <a href="?start={{g.start-g.count if g.start-g.count > 0 else 0}}">上一页</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    {% endif %}
    <a href="?start={{g.start+g.count}}">下一页</a>
</div>
{% endblock %}

